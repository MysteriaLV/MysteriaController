<!doctype html>
<html>
<head>
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/sijax/sijax.js"></script>
    <script type="text/javascript">        {{ g.sijax.get_js()|safe }}    </script>
</head>

<body>

<H1>State machines</H1>
{% for fsm_name in state.fsms %}
{% set fsm = state.fsms[fsm_name] %}
<div id="fsm.{{ fsm }}">
    <span class="fsm.name">{{ fsm_name }} : {{ fsm.current  }}</span>
    <ul>
        {% for event in fsm.events %}
        <li><a onclick="Sijax.request('fire_event_fsm', ['{{ fsm_name }}', '{{ event }}'])"> {{ event }}</a></li>
        {% endfor %}
    </ul>
</div>
{% endfor %}

<H1>Peripherals</H1>
{% for slave_id in state.modbus.slaves %}
{% set slave = state.modbus.slaves[slave_id] %}
<div id="slave.{{ slave_id }}">
    <span class="slave.name">{{ slave.name }} : {{ slave.fsm.current }}</span>
    <span class="slave.errors">Remote errors: {{ state.modbus.get_remote_errors(slave) }} </span>
    <span class="slave.errors">Local errors: {{ slave.errors }} </span>
    <span class="slave.data">Current data: {{ slave.current_data }} </span>
</div>
<ul>
    {% for event in slave.fsm.events %}
    <li><a onclick="Sijax.request('fire_event_modbus_fsm', ['{{ slave_id }}', '{{ event }}'])"> {{ event }}</a></li>
    {% endfor %}
</ul>
{% endfor %}

</body>
</html>